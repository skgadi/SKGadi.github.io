<html>
<head>
	<meta charset="utf-8">
	<title>SKGadi's eLibrary - Books</title>
	<link rel="icon" type="image/x-icon" href="favicon.ico" />
	<link rel="stylesheet" href="css/font-cm.css">
	<link rel="stylesheet" href="css/font-uc.css">
	<link rel="stylesheet" href="css/web-style.css">
	
	<link type="text/css" rel="stylesheet" href="libs/layout.jquery-dev/layout-default-latest.css" />

	<script   src="https://code.jquery.com/jquery-2.2.4.min.js"   integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="   crossorigin="anonymous"></script>
	<script type="text/javascript">
	var dbFileName = "SKGadiReferenceManagerBooks";
	var TopicsFileName = "SKGadiReferenceManagerTopics";
	var CLIENT_ID = '283101023526-4o4jti8tl8cusebbogg2qlhpva45uon1.apps.googleusercontent.com';
	var SCOPES = ["https://www.googleapis.com/auth/spreadsheets",
		"https://www.googleapis.com/auth/drive",
		"https://www.googleapis.com/auth/drive.appdata",
		"https://www.googleapis.com/auth/drive.file",
		"https://www.googleapis.com/auth/drive.metadata",
		//"https://www.googleapis.com/auth/drive.metadata.readonly",
		//"https://www.googleapis.com/auth/drive.photos.readonly",
		//"https://www.googleapis.com/auth/drive.readonly"
	];
	var bibstring = "";
	function checkAuth() {
		gapi.auth.authorize({
			'client_id' : CLIENT_ID,
			'scope' : SCOPES.join(' '),
			'immediate' : true
		}, handleAuthResult);
	}

	function handleAuthResult(authResult) {
		var authorizeDiv = document.getElementById('authorize-div');
		if (authResult && !authResult.error) {
			authorizeDiv.style.display = 'none';
			$(".Authrozed ").css('display','inline');
			loadSheetsApi();
		} else {
			authorizeDiv.style.display = 'inline';
			$(".Authrozed ").css('display','none');
		}
	}

	function handleAuthClick(event) {
		gapi.auth.authorize({
			client_id : CLIENT_ID,
			scope : SCOPES,
			immediate : false
		},
			handleAuthResult);
		return false;
	}

	function loadSheetsApi() {
		var discoveryUrl =
			'https://sheets.googleapis.com/$discovery/rest?version=v4';
		gapi.client.load(discoveryUrl).then(function () {
			gapi.client.load('drive', 'v3', listFiles);
		});
	}

	function listFiles() {
		var request = gapi.client.drive.files.list({
				'q' : 'name=\''+dbFileName+'\'',
				'pageSize' : 10,
				'fields' : "nextPageToken, files(id, name)"
			});

		request.execute(function (resp) {
			var files = resp.files;
			if (files && files.length > 0) {
				$.notify("Please wait while we process your database. If it is taking longer than usual, please refresh.", "success");
				GetBibTexString(files[0].id);
				VerifyTopicsDb();
			} else {
				//appendPre('No files found.');
				$.notify("No database file is found. Please wait while we create one for you.", "error");
				SpreadsheetCreate()
			}
		});
	}
	
	function VerifyTopicsDb () {
		var request = gapi.client.drive.files.list({
				'q' : 'name=\''+TopicsFileName+'\'',
				'pageSize' : 10,
				'fields' : "nextPageToken, files(id, name)"
			});
		request.execute(function (resp) {
			var files = resp.files;
			if (files && files.length > 0) {
				GetTopicsFromDB(files[0].id);
			} else {
				$.notify("No topics database is found.", "error");
				CreateTopicsDatabase()
			}
		});
	}

	function GetBibTexString(id) {
		gapi.client.sheets.spreadsheets.values.get({
			spreadsheetId : id,
			range : 'db!A1:A',
		}).then(function (response) {
			var range = response.result;
			if (range.values.length > 0) {
				//if ((range.values.length) > 1)
				for (i = 0; i < ((range.values.length)-1); i++) {
					/*var row = range.values[i];
					appendPre(row[0] + ', ' + row[3]);*/
					bibstring += '\n' + range.values[i+1][0] + '\n';
				}
				(new BibtexDisplay()).displayBibtex(bibstring, $("#bibtex_display"));
				 loadExtras();
				//appendPre(bibstring);
			} else {
				//appendPre('No data found.');
			}
		});
		reset();
	}
	function GetTopicsFromDB(id) {
		//Setting the topics
		gapi.client.sheets.spreadsheets.values.get({
			spreadsheetId : id,
			range : 'topics!A1:B',
		}).then(function (response) {
			var range = response.result;
			$('#topicselect').html("");
			if (range.values.length > 0) {
				$('#topicselect').append("<option value=''>All topics</option>");
				for (i = 0; i < ((range.values.length)-1); i++) {
					var row = range.values[i+1];
					$('#topicselect').append("<option value='"+row[1]+"'>"+row[0]+"</option>");
				}
				reset();
				//appendPre(bibstring);
			} else {
				$('#topicselect').append("<option value=''>Topics: NA</option>");
				//appendPre('No data found.');
			}
		});
	}
	function SpreadsheetCreate() {
		/*var URI = "https://www.googleapis.com/drive/v3/files?corpus=user&q=name%3D%22temp%22&key="+CLIENT_ID;
		$.post(URI, function (data) {

		alert(JSON.stringify(data, null, 4));
		});*/
		gapi.client.sheets.spreadsheets.create({
			"properties" : {
				"title" : dbFileName
			},
			sheets : [{
					"properties" : {
						"sheetId" : 0,
						"title" : "db"
					},
					"data" : [{
							"startRow" : 0,
							"startColumn" : 0,
							"rowData" : [{
									"values" : [{
											"userEnteredValue" : {
												"stringValue" : "bibtex"
											}
										}
									]
								}
							]
						}
					]
				}
			]
		}).then(function (response) {
			listFiles();
			$.notify("a set of database files are created in your google drive.", "success");
		});
	}
	
	function CreateTopicsDatabase () {
		gapi.client.sheets.spreadsheets.create({
			"properties" : {
				"title" : TopicsFileName
			},
			sheets : [{
					"properties" : {
						"sheetId" : 0,
						"title" : "topics"
					},
					"data" : [{
							"startRow" : 0,
							"startColumn" : 0,
							"rowData" : [{
									"values" : [{
											"userEnteredValue" : {
												"stringValue" : "head"
											}
										}
									]
								}
							]
						}, {
							"startRow" : 0,
							"startColumn" : 1,
							"rowData" : [{
									"values" : [{
											"userEnteredValue" : {
												"stringValue" : "values"
											}
										}
									]
								}
							]
						}, {
							"startRow" : 1,
							"startColumn" : 0,
							"rowData" : [{
									"values" : [{
											"userEnteredValue" : {
												"stringValue" : "Mathematics"
											}
										}
									]
								}
							]
						}, {
							"startRow" : 1,
							"startColumn" : 1,
							"rowData" : [{
									"values" : [{
											"userEnteredValue" : {
												"stringValue" : "stability|mathematics|Statistics"
											}
										}
									]
								}
							]
						}
					]
				}
			]
		}).then(function (response){
			VerifyTopicsDb();
			$.notify("The topics database is created in your google drive.", "success");
		});;
	}

	/*$(document).ready(function () {
		//loadSheetsApi();
	});
	*/
	function onSignIn(user) {
		var profile = user.getBasicProfile();
		$('#profile .name').text(profile.getName());
		$('#profile .email').text(profile.getEmail());
	}
	</script>
	<script src="https://apis.google.com/js/client.js?onload=checkAuth"> </script>
	<script src="libs/bibtex_js.js" type="text/javascript" charset="utf-8"></script>
	<!--bibtex src="bibtex/skgadi-publications.bib"></bibtex-->

	<!--script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script-->
</head>
<body class="Font001">
	<!--pre id="output"></pre-->

	
	
	
	
	
<div class="outer-center" style="background: #FFFFF0;"> <!--Part of layout-->
<div class="bibtex_structure">
  <div class="group year" extra="ASC number">
  	  <div class="sort title" extra="ASC string"> <!--DESC string-->
      	<div class="templates"></div>
      </div>
  </div>
</div>

<div id="bibtex_display" style="padding: 5px;">
	<div class="if bibtex_template" style="display: none;">
		<ul><li>
			<span class="SKGListItem bibtexVar" id="bib+BIBTEXKEY+" extra="BIBTEXKEY" onclick="DisplayItem('BIBD+BIBTEXKEY+')">
				<span class="if title"><span class="title"></span>.</span>
				<span class="if author"><em><span class="author"></span></em>.</span>
				<span class="if edition">Edition: <span class="edition"></span>.</span>
				<span class="if year"><span class="year"></span>.</span>
			</span>
			<div style="display: none;" class="bibtexVar" id="BIBD+BIBTEXKEY+" extra="BIBTEXKEY">
		
				<div class="if title" ><h1 style="font-family: 'cmu_serif'; font-weight: normal; text-align: center; margin: 0px;"><span class="title"></span></h1></div>
				<br/>
				<div class="if author"><h4 style="font-family: 'cmu_serif'; font-weight: normal; text-align: center;  margin: 0px;"><span class="author"></span></h4></div>
				<div class="if organization"><h4 style="font-family: 'cmu_serif'; font-weight: normal; text-align: center; margin: 0px;"><em><span class="organization"></span></em></h4></div>
				<div class="if booktitle"><h4 style="font-family: 'cmu_serif'; font-weight: normal; text-align: center; margin: 0px;"><em><span class="booktitle"></span></em></h4></div>
				<br/>
				<div class="if abstract"><span style="font-family: 'cmu_serif'; font-weight: bold; text-align: center; margin: 0px;">Abstract:&ndash; </span><span class="abstract" style="font-family: 'cmu_serif'; font-weight: normal; text-align: justify;"></span></div>
				<br/>
				<b>More information:</b>
				<table class="ContentTable">
					<!--TR class="if title"><TD>Title</TD><TD><span class="title"></span></TD></TR>
					<TR class="if author"><TD>Author</TD><TD><span class="author"></span></TD></TR>
					<TR class="if organization"><TD>Organization</TD><TD><span class="organization"></span></TD></TR>
					<TR class="if booktitle"><TD>Book Title</TD><TD><span class="booktitle"></span></TD></TR>
					<TR class="if abstract"><TD>Abstract</TD><TD><span class="abstract"></span></TD></TR-->

					<TR class="if address"><TD>Address</TD><TD><span class="address"></span></TD></TR>
					<TR class="if annote"><TD>Annote</TD><TD><span class="annote"></span></TD></TR>
					<TR class="if chapter"><TD>Chapter</TD><TD><span class="chapter"></span></TD></TR>
					<TR class="if crossref"><TD>Crossref</TD><TD><span class="crossref"></span></TD></TR>
					<TR class="if doi"><TD>DOI</TD><TD><span style="cursor: pointer;" class="doi" onclick="OpenDOI(this);"></span></TD></TR>
					<TR class="if edition"><TD>Edition</TD><TD><span class="edition"></span></TD></TR>
					<TR class="if editor"><TD>Editor</TD><TD><span class="editor"></span></TD></TR>
					<TR class="if howpublished"><TD>How published</TD><TD><span class="howpublished"></span></TD></TR>
					<TR class="if institution"><TD>Institution</TD><TD><span class="institution"></span></TD></TR>
					<TR class="if journal"><TD>Journal</TD><TD><span class="journal"></span></TD></TR>
					<TR class="if key"><TD>Key</TD><TD><span class="key"></span></TD></TR>
					<TR class="if month"><TD>Month</TD><TD><span class="month"></span></TD></TR>
					<TR class="if note"><TD>Note</TD><TD><span class="note"></span></TD></TR>
					<TR class="if number"><TD>Number</TD><TD><span class="number"></span></TD></TR>
					<TR class="if pages"><TD>Pages</TD><TD><span class="pages"></span></TD></TR>
					<TR class="if publisher"><TD>Publisher</TD><TD><span class="publisher"></span></TD></TR>
					<TR class="if school"><TD>School</TD><TD><span class="school"></span></TD></TR>
					<TR class="if series"><TD>Series</TD><TD><span class="series"></span></TD></TR>
					<TR class="if type"><TD>Type</TD><TD><span class="type"></span></TD></TR>
					<TR class="if url"><TD>URL</TD><TD><span style="cursor: pointer;" class="url" onclick="OpenURL(this);"></span></TD></TR>
					<TR class="if volume"><TD>Volume</TD><TD><span class="volume"></span></TD></TR>
					<TR class="if year"><TD>Year</TD><TD><span class="year"></span></TD></TR>
				</table>
				<br/>
				<div style="position: relative;">
				<pre class = "BibTeXRawCodeBlock" onclick="SelectTheText(this)" ondblclick="CopyTheText(this);"><span class="bibtexraw noread"></span></pre>
				<a style="display: float;position: absolute; bottom: 0px; right: 5px; font-size: 40px; cursor: pointer;" onclick="CopyThePrevText(this)">&#x2398;</a>
				</div>
				<p>Search this material in your cloud storage:</p>
				<img  style="cursor: pointer; height: 50px;" class="bibtexVar" onclick="OpenFile('+BIBTEXKEY+',1)" extra="BIBTEXKEY" src="images/logo-mega.png"></img>
				<img  style="cursor: pointer; height: 50px;" class="bibtexVar" onclick="OpenFile('+BIBTEXKEY+',2)" extra="BIBTEXKEY" src="images/logo-drive.png"></img>
			</div>
		</li></ul>
	</div>
  
</div>

</div>
<div class="outer-east" style="background: #FFFFF0;"><div id="PutHTMLHere" style="padding: 5px; text-align: justify; font-family: 'cmu_serif';">Select an entry to view the complete details here.</div></div>

<div class="ui-layout-north" style="background: #FFFFF0;">
			<div class="searchbar">
				<div style="align-text: center;">
					<div style="width: 120px; display: inline-block;">
						<a onclick="window.location.reload()" class="GSKLogo">SKGadi's eLibrary</a>
					</div>
					<button id="authorize-div" onclick="handleAuthClick(event)" style=" padding: 0px 6px; font-family: 'Univers57Condensed'; display: none;" type="button" class="Button">Authorize</button>
					<input style="height: 18px; background: #FFFFF0;" type="text" class="Authrozed bibtex_search form-control SKGSearchItem" id="searchbar" placeholder="Search - Example: journal 2015 (finds the intersection of the two terms)"/>
					<select id="authorselectfirst" class="Authrozed bibtex_search bibtex_author SKGSearchItem" style="font-family: 'Univers57Condensed'; background: #FFFFF0; cursor: pointer;" extra="first" search="author">
						<option value="">Search First Author</option>
					</select>
					<select id="authorselect" class="Authrozed bibtex_search bibtex_author SKGSearchItem" style="font-family: 'Univers57Condensed'; background: #FFFFF0; cursor: pointer;" search="author">
						<option value="">Search Author</option>
					</select>
					<select id="topicselect" class="Authrozed bibtex_search SKGSearchItem" style="font-family: 'Univers57Condensed'; background: #FFFFF0; cursor: pointer;">
						<!--option value="">Search Topic</option-->
						<!-- Add topic values here -->
						<!--option value="Autonomy">Autonomy</option>
						<option value="Symbiotic">Symbiotic Autonomy</option>
						<option value="CoBot|localization|Coltin|Rosenthal|Perera">CoBot</option>
						<option value="Learning">Learning</option>
						<option value="Multiagent">Multiagent Systems</option>
						<option value="Multi-robot|Multirobot|soccer|Multiagent">Multirobot Systems</option>
						<option value="Planning">Planning</option>
						<option value="Robot">Autonomous Robots</option>
						<option value="Localization">Robot Localization</option>
						<option value="Soccer|Multi-robot">Robot Soccer</option>
						<option value="Vision">Vision</option-->
					</select>
					<button style=" padding: 0px 6px; font-family: 'Univers57Condensed';" type="button"  class="Authrozed Button" onclick="reset()">Reset</button>
					<button style=" padding: 0px 6px; font-family: 'Univers57Condensed';" type="button"  class="Authrozed Button" onclick="download('refs.bib',bibstring)"><small>&#x1f4be;</small>BibTeX</button>

				</div>
			</div>
</div>
<div class="outer-west" style="background: #FFFFF0;"><div id="NavBarHere"></div></div>
<div class="ui-layout-south" id="FooterHere" style="background: #FFFFF0;"></div>


<script   src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"   integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="   crossorigin="anonymous"></script>
<script type="text/javascript" src="libs/notify.min.js"></script>
<script type="text/javascript" src="script.js"></script>

<script type="text/javascript" src="libs/layout.jquery-dev/jquery.layout-latest.js"></script>




	
	
	
	
</body>
</html>